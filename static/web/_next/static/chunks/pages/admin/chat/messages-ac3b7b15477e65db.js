(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7095],{62433:function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/chat/messages",function(){return __webpack_require__(57533)}])},37926:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{e:function(){return BanUserButton}});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(85893),antd__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(85402),antd__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(71577),_ant_design_icons__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(21640),_ant_design_icons__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(82911),_ant_design_icons__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(84674),_utils_apis__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(64777);let BanUserButton=param=>{let{user,isEnabled,label,onClick}=param;async function buttonClicked(param){let{id}=param;try{let result=await (0,_utils_apis__WEBPACK_IMPORTED_MODULE_1__.rQ)(_utils_apis__WEBPACK_IMPORTED_MODULE_1__.NM,{data:{userId:id,enabled:!isEnabled},method:"POST",auth:!0});return result.success}catch(e){console.error(e)}return!1}let actionString=isEnabled?"ban":"unban",icon=isEnabled?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_ant_design_icons__WEBPACK_IMPORTED_MODULE_2__.Z,{style:{color:"var(--ant-error)"}}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_ant_design_icons__WEBPACK_IMPORTED_MODULE_3__.Z,{style:{color:"var(--ant-warning)"}}),content=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{children:["Are you sure you want to ",actionString," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("strong",{children:user.displayName}),isEnabled?" and remove their messages?":"?"]}),confirmBlockAction=()=>{antd__WEBPACK_IMPORTED_MODULE_4__.Z.confirm({title:"Confirm ".concat(actionString),content,onCancel(){},onOk:()=>new Promise((resolve,reject)=>{let result=buttonClicked(user);result?setTimeout(()=>{resolve(result),null==onClick||onClick()},3e3):reject()}),okType:"danger",okText:isEnabled?"Absolutely":null,icon})};return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_5__.Z,{onClick:confirmBlockAction,size:"small",icon:isEnabled?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_ant_design_icons__WEBPACK_IMPORTED_MODULE_6__.Z,{twoToneColor:"#ff4d4f"}):null,className:"block-user-button",children:label||actionString})};BanUserButton.defaultProps={label:"",onClick:null}},17388:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{Z:function(){return UserPopover}});var jsx_runtime=__webpack_require__(85893),react=__webpack_require__(67294),tooltip=__webpack_require__(94199),modal=__webpack_require__(85402),typography=__webpack_require__(84485),row=__webpack_require__(25968),col=__webpack_require__(6226),divider=__webpack_require__(27049),space=__webpack_require__(26713),formatDistanceToNow=__webpack_require__(45938),format=__webpack_require__(58091),lodash=__webpack_require__(96486),BanUserButton=__webpack_require__(37926),es_button=__webpack_require__(71577),ExclamationCircleFilled=__webpack_require__(21640),QuestionCircleFilled=__webpack_require__(82911),StopTwoTone=__webpack_require__(84674),SafetyCertificateTwoTone=__webpack_require__(24478),apis=__webpack_require__(64777);let ModeratorUserButton=param=>{var ref;let{user,onClick}=param;async function buttonClicked(param,setAsModerator){let{id}=param;try{let result=await (0,apis.rQ)(apis.jr,{data:{userId:id,isModerator:setAsModerator},method:"POST",auth:!0});return result.success}catch(e){console.error(e)}return!1}let isModerator=null===(ref=user.scopes)||void 0===ref?void 0:ref.includes("MODERATOR"),actionString=isModerator?"remove moderator":"add moderator",icon=isModerator?(0,jsx_runtime.jsx)(ExclamationCircleFilled.Z,{style:{color:"var(--ant-error)"}}):(0,jsx_runtime.jsx)(QuestionCircleFilled.Z,{style:{color:"var(--ant-warning)"}}),content=(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Are you sure you want to ",actionString," ",(0,jsx_runtime.jsx)("strong",{children:user.displayName}),"?"]}),confirmBlockAction=()=>{modal.Z.confirm({title:"Confirm ".concat(actionString),content,onCancel(){},onOk:()=>new Promise((resolve,reject)=>{let result=buttonClicked(user,!isModerator);result?setTimeout(()=>{resolve(result),null==onClick||onClick()},3e3):reject()}),okType:"danger",okText:isModerator?"Yup!":null,icon})};return(0,jsx_runtime.jsx)(es_button.Z,{onClick:confirmBlockAction,size:"small",icon:isModerator?(0,jsx_runtime.jsx)(StopTwoTone.Z,{twoToneColor:"#ff4d4f"}):(0,jsx_runtime.jsx)(SafetyCertificateTwoTone.Z,{twoToneColor:"#22bb44"}),className:"block-user-button",children:actionString})};ModeratorUserButton.defaultProps={onClick:null};var UserTable=__webpack_require__(55709),utils_format=__webpack_require__(70241);let UserPopover=param=>{let{user,connectionInfo,children}=param,[isModalOpen,setIsModalOpen]=(0,react.useState)(!1),handleShowModal=()=>{setIsModalOpen(!0)},handleCloseModal=()=>{setIsModalOpen(!1)},{displayName,createdAt,previousNames,nameChangedAt,disabledAt}=user,{connectedAt,messageCount,userAgent}=connectionInfo||{},lastNameChangeDate=null,nameList=previousNames&&[...previousNames];previousNames&&previousNames.length>1&&nameChangedAt&&(lastNameChangeDate=new Date(nameChangedAt),nameList.reverse());let dateObject=new Date(createdAt),createdAtDate=(0,format.Z)(dateObject,"PP pp"),lastNameChangeDuration=lastNameChangeDate?(0,formatDistanceToNow.Z)(lastNameChangeDate):null;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(tooltip.Z,{title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Created at: ",createdAtDate,".",(0,jsx_runtime.jsx)("br",{})," Click for more info."]}),placement:"bottomLeft",children:(0,jsx_runtime.jsx)("button",{type:"button","aria-label":"Display more details about this user",className:"user-item-container",onClick:handleShowModal,children:children})}),(0,jsx_runtime.jsx)(modal.Z,{destroyOnClose:!0,width:600,cancelText:"Close",okButtonProps:{style:{display:"none"}},title:"User details: ".concat(displayName),open:isModalOpen,onOk:handleCloseModal,onCancel:handleCloseModal,children:(0,jsx_runtime.jsxs)("div",{className:"user-details",children:[(0,jsx_runtime.jsx)(typography.Z.Title,{level:4,children:displayName}),(0,jsx_runtime.jsxs)("p",{className:"created-at",children:["User created at ",createdAtDate,"."]}),(0,jsx_runtime.jsxs)(row.Z,{gutter:16,children:[connectionInfo&&(0,jsx_runtime.jsxs)(col.Z,{md:lastNameChangeDate?12:24,children:[(0,jsx_runtime.jsx)(typography.Z.Title,{level:5,children:"This user is currently connected to Chat."}),(0,jsx_runtime.jsxs)("ul",{className:"connection-info",children:[(0,jsx_runtime.jsxs)("li",{children:[(0,jsx_runtime.jsx)("strong",{children:"Active for:"})," ",(0,formatDistanceToNow.Z)(new Date(connectedAt))]}),(0,jsx_runtime.jsxs)("li",{children:[(0,jsx_runtime.jsx)("strong",{children:"Messages sent:"})," ",messageCount]}),(0,jsx_runtime.jsxs)("li",{children:[(0,jsx_runtime.jsx)("strong",{children:"User Agent:"}),(0,jsx_runtime.jsx)("br",{}),(0,utils_format.AB)(userAgent)]})]})]}),lastNameChangeDate&&(0,jsx_runtime.jsxs)(col.Z,{md:connectionInfo?12:24,children:[(0,jsx_runtime.jsx)(typography.Z.Title,{level:5,children:"This user is also seen as:"}),(0,jsx_runtime.jsx)("ul",{className:"previous-names-list",children:(0,lodash.uniq)(nameList).map((name,index)=>(0,jsx_runtime.jsxs)("li",{className:0===index?"latest":"",children:[(0,jsx_runtime.jsx)("span",{className:"user-name-item",children:name}),0===index?" (Changed ".concat(lastNameChangeDuration," ago)"):""]}))})]})]}),(0,jsx_runtime.jsx)(divider.Z,{}),(0,jsx_runtime.jsxs)(space.Z,{direction:"horizontal",children:[disabledAt?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["This user was banned on ",(0,jsx_runtime.jsx)("code",{children:(0,UserTable.u)(disabledAt)}),".",(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)(BanUserButton.e,{label:"Unban this user",user:user,isEnabled:!1,onClick:handleCloseModal})]}):(0,jsx_runtime.jsx)(BanUserButton.e,{label:"Ban this user",user:user,isEnabled:!0,onClick:handleCloseModal}),(0,jsx_runtime.jsx)(ModeratorUserButton,{user:user,onClick:handleCloseModal})]})]})})]})};UserPopover.defaultProps={connectionInfo:null}},55709:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{K:function(){return UserTable},u:function(){return formatDisplayDate}});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(85893),antd__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(93626),date_fns_format__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(58091),_UserPopover__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(17388),_BanUserButton__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(37926);function formatDisplayDate(date){return(0,date_fns_format__WEBPACK_IMPORTED_MODULE_3__.Z)(new Date(date),"MMM d H:mma")}let UserTable=param=>{let{data}=param;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_4__.Z,{pagination:{hideOnSinglePage:!0},className:"table-container",columns:[{title:"Last Known Display Name",dataIndex:"displayName",key:"displayName",render:(displayName,user)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_UserPopover__WEBPACK_IMPORTED_MODULE_1__.Z,{user:user,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"display-name",children:displayName})})},{title:"Created",dataIndex:"createdAt",key:"createdAt",render:date=>formatDisplayDate(date),sorter:(a,b)=>new Date(a.createdAt).getTime()-new Date(b.createdAt).getTime(),sortDirections:["descend","ascend"]},{title:"Disabled at",dataIndex:"disabledAt",key:"disabledAt",defaultSortOrder:"descend",render:date=>date?formatDisplayDate(date):null,sorter:(a,b)=>new Date(a.disabledAt).getTime()-new Date(b.disabledAt).getTime(),sortDirections:["descend","ascend"]},{title:"",key:"block",className:"actions-col",render:(_,user)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_BanUserButton__WEBPACK_IMPORTED_MODULE_2__.e,{user:user,isEnabled:!user.disabledAt})}],dataSource:data,size:"small",rowKey:"id"})}},57533:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{OUTCOME_TIMEOUT:function(){return OUTCOME_TIMEOUT},default:function(){return Chat}});var jsx_runtime=__webpack_require__(85893),react=__webpack_require__(67294),typography=__webpack_require__(84485),es_button=__webpack_require__(71577),table=__webpack_require__(93626),CheckCircleFilled=__webpack_require__(89739),ExclamationCircleFilled=__webpack_require__(21640),classnames=__webpack_require__(94184),classnames_default=__webpack_require__.n(classnames),format=__webpack_require__(58091),apis=__webpack_require__(64777),utils_format=__webpack_require__(70241),tooltip=__webpack_require__(94199),EyeOutlined=__webpack_require__(99611),EyeInvisibleOutlined=__webpack_require__(90420);let MessageVisiblityToggle=param=>{let{isVisible,message,setMessage}=param;if(!message||(0,utils_format.Qr)(message))return null;let outcomeTimeout=null,[outcome,setOutcome]=(0,react.useState)(0),{id:messageId}=message||{},resetOutcome=()=>{outcomeTimeout=setTimeout(()=>{setOutcome(0)},OUTCOME_TIMEOUT)};(0,react.useEffect)(()=>()=>{clearTimeout(outcomeTimeout)});let updateChatMessage=async()=>{clearTimeout(outcomeTimeout),setOutcome(0);let result=await (0,apis.rQ)(apis.hn,{auth:!0,method:"POST",data:{visible:!isVisible,idArray:[messageId]}});result.success&&"changed"===result.message?(setMessage({...message,visible:!isVisible}),setOutcome(1)):(setMessage({...message,visible:isVisible}),setOutcome(-1)),resetOutcome()},outcomeIcon=(0,jsx_runtime.jsx)(CheckCircleFilled.Z,{style:{color:"transparent"}});return outcome&&(outcomeIcon=outcome>0?(0,jsx_runtime.jsx)(CheckCircleFilled.Z,{style:{color:"var(--ant-success)"}}):(0,jsx_runtime.jsx)(ExclamationCircleFilled.Z,{style:{color:"var(--ant-warning)"}})),(0,jsx_runtime.jsxs)("div",{className:"toggle-switch ".concat(isVisible?"":"hidden"),children:[(0,jsx_runtime.jsx)("span",{className:"outcome-icon",children:outcomeIcon}),(0,jsx_runtime.jsx)(tooltip.Z,{title:"Click to ".concat(isVisible?"hide":"show"," this message"),placement:"topRight",children:(0,jsx_runtime.jsx)(es_button.Z,{shape:"circle",size:"small",type:"text",icon:isVisible?(0,jsx_runtime.jsx)(EyeOutlined.Z,{}):(0,jsx_runtime.jsx)(EyeInvisibleOutlined.Z,{}),onClick:updateChatMessage})})]})};var UserPopover=__webpack_require__(17388);let{Title}=typography.Z,OUTCOME_TIMEOUT=3e3;function Chat(){let[messages,setMessages]=(0,react.useState)([]),[selectedRowKeys,setSelectedRows]=(0,react.useState)([]),[bulkProcessing,setBulkProcessing]=(0,react.useState)(!1),[bulkOutcome,setBulkOutcome]=(0,react.useState)(null),[bulkAction,setBulkAction]=(0,react.useState)(""),outcomeTimeout=null,chatReloadInterval=null,getInfo=async()=>{try{let result=await (0,apis.rQ)(apis.WE,{auth:!0});(0,utils_format.Qr)(result)?setMessages([]):setMessages(result)}catch(error){console.log("==== error",error)}};(0,react.useEffect)(()=>(getInfo(),chatReloadInterval=setInterval(()=>{getInfo()},apis.NE),()=>{clearTimeout(outcomeTimeout),clearTimeout(chatReloadInterval)}),[]);let nameFilters=function(messages){let filtered=messages.reduce((acc,curItem)=>{let curAuthor=curItem.user.id;return acc.some(item=>item.text===curAuthor)||acc.push({text:curAuthor,value:curAuthor}),acc},[]);return filtered.sort((a,b)=>{let nameA=a.text.toUpperCase(),nameB=b.text.toUpperCase();return nameA<nameB?-1:nameA>nameB?1:0})}(messages),updateMessage=message=>{let messageIndex=messages.findIndex(m=>m.id===message.id);messages.splice(messageIndex,1,message),setMessages([...messages])},resetBulkOutcome=()=>{outcomeTimeout=setTimeout(()=>{setBulkOutcome(null),setBulkAction("")},OUTCOME_TIMEOUT)},handleSubmitBulk=async bulkVisibility=>{setBulkProcessing(!0);let result=await (0,apis.rQ)(apis.hn,{auth:!0,method:"POST",data:{visible:bulkVisibility,idArray:selectedRowKeys}});if(result.success&&"changed"===result.message){setBulkOutcome((0,jsx_runtime.jsx)(CheckCircleFilled.Z,{})),resetBulkOutcome();let updatedList=[...messages];selectedRowKeys.map(key=>{let messageIndex=updatedList.findIndex(m=>m.id===key),newMessage={...messages[messageIndex],visible:bulkVisibility};return updatedList.splice(messageIndex,1,newMessage),null}),setMessages(updatedList),setSelectedRows([])}else setBulkOutcome((0,jsx_runtime.jsx)(ExclamationCircleFilled.Z,{})),resetBulkOutcome();setBulkProcessing(!1)},handleSubmitBulkShow=()=>{setBulkAction("show"),handleSubmitBulk(!0)},handleSubmitBulkHide=()=>{setBulkAction("hide"),handleSubmitBulk(!1)},bulkDivClasses=classnames_default()({"bulk-editor":!0,active:selectedRowKeys.length});return(0,jsx_runtime.jsxs)("div",{className:"chat-messages",children:[(0,jsx_runtime.jsx)(Title,{children:"Chat Messages"}),(0,jsx_runtime.jsx)("p",{children:"Manage the messages from viewers that show up on your stream."}),(0,jsx_runtime.jsxs)("div",{className:bulkDivClasses,children:[(0,jsx_runtime.jsx)("span",{className:"label",children:"Check multiple messages to change their visibility to: "}),(0,jsx_runtime.jsx)(es_button.Z,{type:"primary",size:"small",shape:"round",className:"button",loading:"show"===bulkAction&&bulkProcessing,icon:"show"===bulkAction&&bulkOutcome,disabled:!selectedRowKeys.length||bulkAction&&"show"!==bulkAction,onClick:handleSubmitBulkShow,children:"Show"}),(0,jsx_runtime.jsx)(es_button.Z,{type:"primary",size:"small",shape:"round",className:"button",loading:"hide"===bulkAction&&bulkProcessing,icon:"hide"===bulkAction&&bulkOutcome,disabled:!selectedRowKeys.length||bulkAction&&"hide"!==bulkAction,onClick:handleSubmitBulkHide,children:"Hide"})]}),(0,jsx_runtime.jsx)(table.Z,{size:"small",className:"table-container",pagination:{defaultPageSize:100,showSizeChanger:!0},scroll:{y:540},rowClassName:record=>record.hiddenAt?"hidden":"",dataSource:messages,columns:[{title:"Time",dataIndex:"timestamp",key:"timestamp",className:"timestamp-col",defaultSortOrder:"descend",render(timestamp){let dateObject=new Date(timestamp);return(0,format.Z)(dateObject,"PP pp")},sorter:(a,b)=>new Date(a.timestamp).getTime()-new Date(b.timestamp).getTime(),width:90},{title:"User",dataIndex:"user",key:"user",className:"name-col",filters:nameFilters,onFilter:(value,record)=>record.user.id===value,sorter:(a,b)=>a.user.displayName.localeCompare(b.user.displayName),sortDirections:["ascend","descend"],ellipsis:!0,render(user){let{displayName}=user;return(0,jsx_runtime.jsx)(UserPopover.Z,{user:user,children:displayName})},width:110},{title:"Message",dataIndex:"body",key:"body",className:"message-col",width:320,render:body=>(0,jsx_runtime.jsx)("div",{className:"message-contents",dangerouslySetInnerHTML:{__html:body}})},{title:"",dataIndex:"hiddenAt",key:"hiddenAt",className:"toggle-col",filters:[{text:"Visible messages",value:!0},{text:"Hidden messages",value:!1}],onFilter:(value,record)=>record.visible===value,render:(hiddenAt,record)=>(0,jsx_runtime.jsx)(MessageVisiblityToggle,{isVisible:!hiddenAt,message:record,setMessage:updateMessage}),width:30}],rowKey:row=>row.id,rowSelection:{selectedRowKeys,onChange(selectedKeys){setSelectedRows(selectedKeys)}}})]})}}},function(__webpack_require__){__webpack_require__.O(0,[3662,8939,3903,4267,3626,8091,5938,7635,9774,2888,179],function(){return __webpack_require__(__webpack_require__.s=62433)}),_N_E=__webpack_require__.O()}]);