(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7095],{62433:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/chat/messages",function(){return t(57533)}])},37926:function(e,s,t){"use strict";t.d(s,{e:function(){return d}});var n=t(85893),l=t(85402),a=t(71577),r=t(21640),i=t(82911),o=t(84674),c=t(64777);let d=e=>{let{user:s,isEnabled:t,label:d,onClick:u}=e;async function m(e){let{id:s}=e;try{let n=await (0,c.rQ)(c.NM,{data:{userId:s,enabled:!t},method:"POST",auth:!0});return n.success}catch(l){console.error(l)}return!1}let h=t?"ban":"unban",x=t?(0,n.jsx)(r.Z,{style:{color:"var(--ant-error)"}}):(0,n.jsx)(i.Z,{style:{color:"var(--ant-warning)"}}),j=(0,n.jsxs)(n.Fragment,{children:["Are you sure you want to ",h," ",(0,n.jsx)("strong",{children:s.displayName}),t?" and remove their messages?":"?"]}),p=()=>{l.Z.confirm({title:"Confirm ".concat(h),content:j,onCancel(){},onOk:()=>new Promise((e,t)=>{let n=m(s);n?setTimeout(()=>{e(n),null==u||u()},3e3):t()}),okType:"danger",okText:t?"Absolutely":null,icon:x})};return(0,n.jsx)(a.Z,{onClick:p,size:"small",icon:t?(0,n.jsx)(o.Z,{twoToneColor:"#ff4d4f"}):null,className:"block-user-button",children:d||h})};d.defaultProps={label:"",onClick:null}},17388:function(e,s,t){"use strict";t.d(s,{Z:function(){return T}});var n=t(85893),l=t(67294),a=t(94199),r=t(85402),i=t(84485),o=t(71230),c=t(15746),d=t(27049),u=t(26713),m=t(45938),h=t(58091),x=t(96486),j=t(37926),p=t(71577),g=t(21640),y=t(82911),b=t(84674),f=t(24478),w=t(64777);let Z=e=>{var s;let{user:t,onClick:l}=e;async function a(e,s){let{id:t}=e;try{let n=await (0,w.rQ)(w.jr,{data:{userId:t,isModerator:s},method:"POST",auth:!0});return n.success}catch(l){console.error(l)}return!1}let i=null===(s=t.scopes)||void 0===s?void 0:s.includes("MODERATOR"),o=i?"remove moderator":"add moderator",c=i?(0,n.jsx)(g.Z,{style:{color:"var(--ant-error)"}}):(0,n.jsx)(y.Z,{style:{color:"var(--ant-warning)"}}),d=(0,n.jsxs)(n.Fragment,{children:["Are you sure you want to ",o," ",(0,n.jsx)("strong",{children:t.displayName}),"?"]}),u=()=>{r.Z.confirm({title:"Confirm ".concat(o),content:d,onCancel(){},onOk:()=>new Promise((e,s)=>{let n=a(t,!i);n?setTimeout(()=>{e(n),null==l||l()},3e3):s()}),okType:"danger",okText:i?"Yup!":null,icon:c})};return(0,n.jsx)(p.Z,{onClick:u,size:"small",icon:i?(0,n.jsx)(b.Z,{twoToneColor:"#ff4d4f"}):(0,n.jsx)(f.Z,{twoToneColor:"#22bb44"}),className:"block-user-button",children:o})};Z.defaultProps={onClick:null};var v=t(55709),N=t(70241);let T=e=>{let{user:s,connectionInfo:t,children:p}=e,[g,y]=(0,l.useState)(!1),b=()=>{y(!0)},f=()=>{y(!1)},{displayName:w,createdAt:T,previousNames:k,nameChangedAt:C,disabledAt:A}=s,{connectedAt:S,messageCount:D,userAgent:O}=t||{},P=null,E=k&&[...k];k&&k.length>1&&C&&(P=new Date(C),E.reverse());let I=new Date(T),_=(0,h.Z)(I,"PP pp"),M=P?(0,m.Z)(P):null;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.Z,{title:(0,n.jsxs)(n.Fragment,{children:["Created at: ",_,".",(0,n.jsx)("br",{})," Click for more info."]}),placement:"bottomLeft",children:(0,n.jsx)("button",{type:"button","aria-label":"Display more details about this user",className:"user-item-container",onClick:b,children:p})}),(0,n.jsx)(r.Z,{destroyOnClose:!0,width:600,cancelText:"Close",okButtonProps:{style:{display:"none"}},title:"User details: ".concat(w),open:g,onOk:f,onCancel:f,children:(0,n.jsxs)("div",{className:"user-details",children:[(0,n.jsx)(i.Z.Title,{level:4,children:w}),(0,n.jsxs)("p",{className:"created-at",children:["User created at ",_,"."]}),(0,n.jsxs)(o.Z,{gutter:16,children:[t&&(0,n.jsxs)(c.Z,{md:P?12:24,children:[(0,n.jsx)(i.Z.Title,{level:5,children:"This user is currently connected to Chat."}),(0,n.jsxs)("ul",{className:"connection-info",children:[(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"Active for:"})," ",(0,m.Z)(new Date(S))]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"Messages sent:"})," ",D]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"User Agent:"}),(0,n.jsx)("br",{}),(0,N.AB)(O)]})]})]}),P&&(0,n.jsxs)(c.Z,{md:t?12:24,children:[(0,n.jsx)(i.Z.Title,{level:5,children:"This user is also seen as:"}),(0,n.jsx)("ul",{className:"previous-names-list",children:(0,x.uniq)(E).map((e,s)=>(0,n.jsxs)("li",{className:0===s?"latest":"",children:[(0,n.jsx)("span",{className:"user-name-item",children:e}),0===s?" (Changed ".concat(M," ago)"):""]}))})]})]}),(0,n.jsx)(d.Z,{}),(0,n.jsxs)(u.Z,{direction:"horizontal",children:[A?(0,n.jsxs)(n.Fragment,{children:["This user was banned on ",(0,n.jsx)("code",{children:(0,v.u)(A)}),".",(0,n.jsx)("br",{}),(0,n.jsx)("br",{}),(0,n.jsx)(j.e,{label:"Unban this user",user:s,isEnabled:!1,onClick:f})]}):(0,n.jsx)(j.e,{label:"Ban this user",user:s,isEnabled:!0,onClick:f}),(0,n.jsx)(Z,{user:s,onClick:f})]})]})})]})};T.defaultProps={connectionInfo:null}},55709:function(e,s,t){"use strict";t.d(s,{K:function(){return c},u:function(){return o}});var n=t(85893),l=t(52206),a=t(58091),r=t(17388),i=t(37926);function o(e){return(0,a.Z)(new Date(e),"MMM d H:mma")}let c=e=>{let{data:s}=e;return(0,n.jsx)(l.Z,{pagination:{hideOnSinglePage:!0},className:"table-container",columns:[{title:"Last Known Display Name",dataIndex:"displayName",key:"displayName",render:(e,s)=>(0,n.jsx)(r.Z,{user:s,children:(0,n.jsx)("span",{className:"display-name",children:e})})},{title:"Created",dataIndex:"createdAt",key:"createdAt",render:e=>o(e),sorter:(e,s)=>new Date(e.createdAt).getTime()-new Date(s.createdAt).getTime(),sortDirections:["descend","ascend"]},{title:"Disabled at",dataIndex:"disabledAt",key:"disabledAt",defaultSortOrder:"descend",render:e=>e?o(e):null,sorter:(e,s)=>new Date(e.disabledAt).getTime()-new Date(s.disabledAt).getTime(),sortDirections:["descend","ascend"]},{title:"",key:"block",className:"actions-col",render:(e,s)=>(0,n.jsx)(i.e,{user:s,isEnabled:!s.disabledAt})}],dataSource:s,size:"small",rowKey:"id"})}},57533:function(e,s,t){"use strict";t.r(s),t.d(s,{OUTCOME_TIMEOUT:function(){return w},default:function(){return Z}});var n=t(85893),l=t(67294),a=t(84485),r=t(71577),i=t(52206),o=t(89739),c=t(21640),d=t(94184),u=t.n(d),m=t(58091),h=t(64777),x=t(70241),j=t(94199),p=t(99611),g=t(90420);let y=e=>{let{isVisible:s,message:t,setMessage:a}=e;if(!t||(0,x.Qr)(t))return null;let i=null,[d,u]=(0,l.useState)(0),{id:m}=t||{},y=()=>{i=setTimeout(()=>{u(0)},w)};(0,l.useEffect)(()=>()=>{clearTimeout(i)});let b=async()=>{clearTimeout(i),u(0);let e=await (0,h.rQ)(h.hn,{auth:!0,method:"POST",data:{visible:!s,idArray:[m]}});e.success&&"changed"===e.message?(a({...t,visible:!s}),u(1)):(a({...t,visible:s}),u(-1)),y()},f=(0,n.jsx)(o.Z,{style:{color:"transparent"}});return d&&(f=d>0?(0,n.jsx)(o.Z,{style:{color:"var(--ant-success)"}}):(0,n.jsx)(c.Z,{style:{color:"var(--ant-warning)"}})),(0,n.jsxs)("div",{className:"toggle-switch ".concat(s?"":"hidden"),children:[(0,n.jsx)("span",{className:"outcome-icon",children:f}),(0,n.jsx)(j.Z,{title:"Click to ".concat(s?"hide":"show"," this message"),placement:"topRight",children:(0,n.jsx)(r.Z,{shape:"circle",size:"small",type:"text",icon:s?(0,n.jsx)(p.Z,{}):(0,n.jsx)(g.Z,{}),onClick:b})})]})};var b=t(17388);let{Title:f}=a.Z,w=3e3;function Z(){let[e,s]=(0,l.useState)([]),[t,a]=(0,l.useState)([]),[d,j]=(0,l.useState)(!1),[p,g]=(0,l.useState)(null),[Z,v]=(0,l.useState)(""),N=null,T=null,k=async()=>{try{let e=await (0,h.rQ)(h.WE,{auth:!0});(0,x.Qr)(e)?s([]):s(e)}catch(t){console.log("==== error",t)}};(0,l.useEffect)(()=>(k(),T=setInterval(()=>{k()},h.NE),()=>{clearTimeout(N),clearTimeout(T)}),[]);let C=function(e){let s=e.reduce((e,s)=>{let t=s.user.id;return e.some(e=>e.text===t)||e.push({text:t,value:t}),e},[]);return s.sort((e,s)=>{let t=e.text.toUpperCase(),n=s.text.toUpperCase();return t<n?-1:t>n?1:0})}(e),A=t=>{let n=e.findIndex(e=>e.id===t.id);e.splice(n,1,t),s([...e])},S=()=>{N=setTimeout(()=>{g(null),v("")},w)},D=async l=>{j(!0);let r=await (0,h.rQ)(h.hn,{auth:!0,method:"POST",data:{visible:l,idArray:t}});if(r.success&&"changed"===r.message){g((0,n.jsx)(o.Z,{})),S();let i=[...e];t.map(s=>{let t=i.findIndex(e=>e.id===s),n={...e[t],visible:l};return i.splice(t,1,n),null}),s(i),a([])}else g((0,n.jsx)(c.Z,{})),S();j(!1)},O=()=>{v("show"),D(!0)},P=()=>{v("hide"),D(!1)},E=u()({"bulk-editor":!0,active:t.length});return(0,n.jsxs)("div",{className:"chat-messages",children:[(0,n.jsx)(f,{children:"Chat Messages"}),(0,n.jsx)("p",{children:"Manage the messages from viewers that show up on your stream."}),(0,n.jsxs)("div",{className:E,children:[(0,n.jsx)("span",{className:"label",children:"Check multiple messages to change their visibility to: "}),(0,n.jsx)(r.Z,{type:"primary",size:"small",shape:"round",className:"button",loading:"show"===Z&&d,icon:"show"===Z&&p,disabled:!t.length||Z&&"show"!==Z,onClick:O,children:"Show"}),(0,n.jsx)(r.Z,{type:"primary",size:"small",shape:"round",className:"button",loading:"hide"===Z&&d,icon:"hide"===Z&&p,disabled:!t.length||Z&&"hide"!==Z,onClick:P,children:"Hide"})]}),(0,n.jsx)(i.Z,{size:"small",className:"table-container",pagination:{defaultPageSize:100,showSizeChanger:!0},scroll:{y:540},rowClassName:e=>e.hiddenAt?"hidden":"",dataSource:e,columns:[{title:"Time",dataIndex:"timestamp",key:"timestamp",className:"timestamp-col",defaultSortOrder:"descend",render(e){let s=new Date(e);return(0,m.Z)(s,"PP pp")},sorter:(e,s)=>new Date(e.timestamp).getTime()-new Date(s.timestamp).getTime(),width:90},{title:"User",dataIndex:"user",key:"user",className:"name-col",filters:C,onFilter:(e,s)=>s.user.id===e,sorter:(e,s)=>e.user.displayName.localeCompare(s.user.displayName),sortDirections:["ascend","descend"],ellipsis:!0,render(e){let{displayName:s}=e;return(0,n.jsx)(b.Z,{user:e,children:s})},width:110},{title:"Message",dataIndex:"body",key:"body",className:"message-col",width:320,render:e=>(0,n.jsx)("div",{className:"message-contents",dangerouslySetInnerHTML:{__html:e}})},{title:"",dataIndex:"hiddenAt",key:"hiddenAt",className:"toggle-col",filters:[{text:"Visible messages",value:!0},{text:"Hidden messages",value:!1}],onFilter:(e,s)=>s.visible===e,render:(e,s)=>(0,n.jsx)(y,{isVisible:!e,message:s,setMessage:A}),width:30}],rowKey:e=>e.id,rowSelection:{selectedRowKeys:t,onChange(e){a(e)}}})]})}}},function(e){e.O(0,[3662,8909,3903,4267,2206,8091,5938,9550,9774,2888,179],function(){return e(e.s=62433)}),_N_E=e.O()}]);