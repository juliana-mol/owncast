(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4860],{94860:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ChatModerationActionMenu:function(){return ChatModerationActionMenu}});var jsx_runtime=__webpack_require__(85893),ExclamationCircleOutlined=__webpack_require__(11475),EyeInvisibleOutlined=__webpack_require__(90420),CloseCircleOutlined=__webpack_require__(18429),SmallDashOutlined=__webpack_require__(64942),modal=__webpack_require__(85402),message=__webpack_require__(12461),es_menu=__webpack_require__(66516),dropdown=__webpack_require__(38504),space=__webpack_require__(26713),react=__webpack_require__(67294),Modal=__webpack_require__(14761),collapse=__webpack_require__(54907),row=__webpack_require__(25968),col=__webpack_require__(6226),es_button=__webpack_require__(71577),spin=__webpack_require__(11382),tag=__webpack_require__(20550),table=__webpack_require__(93626),format=__webpack_require__(58091),DeleteOutlined=__webpack_require__(48689),moderation_service=class{static async removeMessage(id,accessToken){let url=new URL("/api/chat/messagevisibility",window.location.toString());url.searchParams.append("accessToken",accessToken);let hideMessageUrl=url.toString(),options={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idArray:[id]})};await fetch(hideMessageUrl,options)}static async banUser(id,accessToken){let url=new URL("/api/chat/users/setenabled",window.location.toString());url.searchParams.append("accessToken",accessToken);let hideMessageUrl=url.toString(),options={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id})};await fetch(hideMessageUrl,options)}},ChatModerationDetailsModal_module=__webpack_require__(57761),ChatModerationDetailsModal_module_default=__webpack_require__.n(ChatModerationDetailsModal_module),utils_format=__webpack_require__(70241);let{Panel}=collapse.Z,removeMessage=async(messageId,accessToken)=>{try{moderation_service.removeMessage(messageId,accessToken)}catch(e){console.error(e)}},ValueRow=param=>{let{label,value}=param;return(0,jsx_runtime.jsxs)(row.Z,{justify:"space-around",align:"middle",children:[(0,jsx_runtime.jsx)(col.Z,{span:12,children:label}),(0,jsx_runtime.jsx)(col.Z,{span:12,children:value})]})},ConnectedClient=param=>{let{client}=param,{messageCount,connectedAt,geo}=client,connectedAtDate=(0,format.Z)(new Date(connectedAt),"PP pp");return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(ValueRow,{label:"Messages Sent",value:"".concat(messageCount)}),"N/A"!==geo&&(0,jsx_runtime.jsx)(ValueRow,{label:"Geo",value:geo}),(0,jsx_runtime.jsx)(ValueRow,{label:"Connected At",value:connectedAtDate})]})},UserColorBlock=param=>{let{color}=param;return(0,jsx_runtime.jsxs)("div",{className:ChatModerationDetailsModal_module_default().colorBlock,style:{backgroundColor:"var(--theme-color-users-".concat(color,")")},children:["Color ",color]})},ChatModerationDetailsModal=param=>{let{userId,accessToken}=param,[userDetails,setUserDetails]=(0,react.useState)(null),[loading,setLoading]=(0,react.useState)(!0),getDetails=async()=>{try{let response=await (await fetch("/api/moderation/chat/user/".concat(userId,"?accessToken=").concat(accessToken))).json();setUserDetails(response),setLoading(!1)}catch(e){console.error(e)}};if((0,react.useEffect)(()=>{getDetails()},[]),!userDetails)return null;let{user,connectedClients,messages}=userDetails,{displayColor,createdAt,previousNames,scopes,isBot,authenticated}=user,totalMessagesSent=connectedClients.reduce((acc,client)=>acc+client.messageCount,0),createdAtDate=(0,format.Z)(new Date(createdAt),"PP pp");return(0,jsx_runtime.jsxs)(spin.Z,{spinning:loading,children:[(0,jsx_runtime.jsx)(UserColorBlock,{color:displayColor}),scopes.map(scope=>(0,jsx_runtime.jsx)(tag.Z,{children:scope},scope)),authenticated&&(0,jsx_runtime.jsx)(tag.Z,{children:"Authenticated"}),isBot&&(0,jsx_runtime.jsx)(tag.Z,{children:"Bot"}),(0,jsx_runtime.jsx)(ValueRow,{label:"Messages Sent Across Clients",value:totalMessagesSent.toString()}),(0,jsx_runtime.jsx)(ValueRow,{label:"User Created",value:createdAtDate}),(0,jsx_runtime.jsx)(ValueRow,{label:"Known As",value:previousNames.join(",")}),(0,jsx_runtime.jsxs)(collapse.Z,{accordion:!0,children:[(0,jsx_runtime.jsx)(Panel,{header:"Currently Connected Clients",children:(0,jsx_runtime.jsx)(collapse.Z,{accordion:!0,children:connectedClients.map(client=>(0,jsx_runtime.jsx)(Panel,{header:(0,utils_format.AB)(client.userAgent),children:(0,jsx_runtime.jsx)(ConnectedClient,{client:client})},client.userAgent))})},"connected-clients"),(0,jsx_runtime.jsx)(collapse.Z,{accordion:!0,children:(0,jsx_runtime.jsx)(Panel,{header:"Recent Chat Messages",children:(0,jsx_runtime.jsx)(table.Z,{size:"small",pagination:null,columns:[{title:"Message",dataIndex:"body",key:"body"},{title:"Sent At",dataIndex:"timestamp",key:"timestamp",render:timestamp=>(0,format.Z)(new Date(timestamp),"PP pp")},{title:"Delete",key:"delete",render:(text,record)=>(0,jsx_runtime.jsx)(es_button.Z,{type:"primary",ghost:!0,icon:(0,jsx_runtime.jsx)(DeleteOutlined.Z,{}),onClick:()=>removeMessage(record.id,accessToken)})}],dataSource:messages})},"chat-messages")})]})]})};var ChatModerationActionMenu_module=__webpack_require__(24110),ChatModerationActionMenu_module_default=__webpack_require__.n(ChatModerationActionMenu_module);let{confirm:ChatModerationActionMenu_confirm}=modal.Z,ChatModerationActionMenu=param=>{let{messageID,userID,userDisplayName,accessToken}=param,[showUserDetailsModal,setShowUserDetailsModal]=(0,react.useState)(!1),handleBanUser=async()=>{try{await moderation_service.banUser(userID,accessToken)}catch(e){console.error(e),message.ZP.error(e)}},handleHideMessage=async()=>{try{await moderation_service.removeMessage(messageID,accessToken)}catch(e){console.error(e),message.ZP.error(e)}},confirmHideMessage=async()=>{ChatModerationActionMenu_confirm({icon:(0,jsx_runtime.jsx)(ExclamationCircleOutlined.Z,{}),content:"Are you sure you want to remove this message from ".concat(userDisplayName,"?"),onOk(){handleHideMessage()}})},confirmBanUser=async()=>{ChatModerationActionMenu_confirm({icon:(0,jsx_runtime.jsx)(ExclamationCircleOutlined.Z,{}),content:"Are you sure you want to ban ".concat(userDisplayName," from chat?"),onOk(){handleBanUser()}})},onMenuClick=param=>{let{key}=param;"hide-message"===key?confirmHideMessage():"ban-user"===key?confirmBanUser():"more-info"===key&&setShowUserDetailsModal(!0)},menu=(0,jsx_runtime.jsx)(es_menu.Z,{onClick:onMenuClick,items:[{label:(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{className:ChatModerationActionMenu_module_default().icon,children:(0,jsx_runtime.jsx)(EyeInvisibleOutlined.Z,{})}),"Hide Message"]}),key:"hide-message"},{label:(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{className:ChatModerationActionMenu_module_default().icon,children:(0,jsx_runtime.jsx)(CloseCircleOutlined.Z,{})}),"Ban User"]}),key:"ban-user"},{label:(0,jsx_runtime.jsx)("div",{children:"More Info..."}),key:"more-info"}]});return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(dropdown.Z,{overlay:menu,trigger:["click"],children:(0,jsx_runtime.jsx)("button",{type:"button",onClick:e=>e.preventDefault(),children:(0,jsx_runtime.jsx)(space.Z,{children:(0,jsx_runtime.jsx)(SmallDashOutlined.Z,{})})})}),(0,jsx_runtime.jsx)(Modal.Modal,{title:userDisplayName,open:showUserDetailsModal,handleCancel(){setShowUserDetailsModal(!1)},children:(0,jsx_runtime.jsx)(ChatModerationDetailsModal,{userId:userID,accessToken:accessToken})})]})}},14761:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Modal:function(){return Modal}});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(85893),antd__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(85402),antd__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(26303),antd__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(11382),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(67294),_Modal_module_scss__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(77011),_Modal_module_scss__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_Modal_module_scss__WEBPACK_IMPORTED_MODULE_4__);let Modal=param=>{let{title,url,open,handleOk,handleCancel,afterClose,height,width,children}=param,[loading,setLoading]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!!url),iframe=url&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("iframe",{title:title,src:url,width:"100%",height:"100%",sandbox:"allow-same-origin allow-scripts allow-popups allow-forms",frameBorder:"0",allowFullScreen:!0,onLoad:()=>setLoading(!1)});return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_2__.Z,{title:title,open:open,onOk:handleOk,onCancel:handleCancel,afterClose:afterClose,bodyStyle:{padding:"0px",minHeight:height,height:null!=height?height:"100%"},width:width,zIndex:9999,footer:null,centered:!0,destroyOnClose:!0,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{children:[loading&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_3__.Z,{active:loading,style:{padding:"10px"},paragraph:{rows:10}}),iframe&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{style:{display:loading?"none":"inline"},children:iframe}),children&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:_Modal_module_scss__WEBPACK_IMPORTED_MODULE_4___default().content,children:children}),loading&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_5__.Z,{className:_Modal_module_scss__WEBPACK_IMPORTED_MODULE_4___default().spinner,spinning:loading,size:"large"})]})})};__webpack_exports__.default=Modal,Modal.defaultProps={url:void 0,children:void 0,handleOk:void 0,handleCancel:void 0,afterClose:void 0}},24110:function(module){module.exports={icon:"ChatModerationActionMenu_icon__9j6DF"}},57761:function(module){module.exports={modalContainer:"ChatModerationDetailsModal_modalContainer__czndV",chatHistory:"ChatModerationDetailsModal_chatHistory__PunRk",colorBlock:"ChatModerationDetailsModal_colorBlock___rAlw",displayName:"ChatModerationDetailsModal_displayName__p7pLI"}},77011:function(module){module.exports={spinner:"Modal_spinner__GiSS0",content:"Modal_content__h9my9"}}}]);