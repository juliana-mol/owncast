(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4977],{94977:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ChatContainer:function(){return ChatContainer}});var _linearGradient,_path,_path2,_path3,_path4,jsx_runtime=__webpack_require__(85893),index_m=__webpack_require__(9764),react=__webpack_require__(67294),EditFilled=__webpack_require__(36531),socket_events=__webpack_require__(91951),ChatContainer_module=__webpack_require__(59760),ChatContainer_module_default=__webpack_require__.n(ChatContainer_module),he=__webpack_require__(86492),he_default=__webpack_require__.n(he),classnames=__webpack_require__(94184),classnames_default=__webpack_require__.n(classnames),tooltip=__webpack_require__(94199),LinkOutlined=__webpack_require__(29158),es=__webpack_require__(4480),dynamic=__webpack_require__(5152),dynamic_default=__webpack_require__.n(dynamic),ChatUserMessage_module=__webpack_require__(50085),ChatUserMessage_module_default=__webpack_require__.n(ChatUserMessage_module),helpers=__webpack_require__(77278);function formatTimestamp(sentAt){let now=new Date(sentAt);if(Number.isNaN(now))return"";let diffInDays=(0,helpers.Xb)(sentAt);if(diffInDays>=1){let localeDate=now.toLocaleDateString("en-US",{dateStyle:"medium"});return"".concat(localeDate," at ").concat(now.toLocaleTimeString())}return"".concat(now.toLocaleTimeString())}var ChatUserBadge_module=__webpack_require__(48976),ChatUserBadge_module_default=__webpack_require__.n(ChatUserBadge_module);let ChatUserBadge=param=>{let{badge,userColor}=param,color="var(--theme-user-colors-".concat(userColor,")");return(0,jsx_runtime.jsx)("span",{style:{color,borderColor:color},className:ChatUserBadge_module_default().badge,children:badge})};var ClientConfigStore=__webpack_require__(77466);let ChatModerationActionMenu=dynamic_default()(()=>Promise.all([__webpack_require__.e(8939),__webpack_require__.e(3903),__webpack_require__.e(4267),__webpack_require__.e(3626),__webpack_require__.e(8091),__webpack_require__.e(1300),__webpack_require__.e(4860)]).then(__webpack_require__.bind(__webpack_require__,94860)).then(mod=>mod.ChatModerationActionMenu),{loadableGenerated:{webpack:()=>[94860]}}),Highlight=dynamic_default()(()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,47049)).then(mod=>mod.Highlight),{loadableGenerated:{webpack:()=>[47049]}}),UserTooltip=param=>{let{children,user}=param,{displayName,createdAt}=user,content="".concat(displayName," first joined ").concat(formatTimestamp(createdAt));return(0,jsx_runtime.jsx)(tooltip.Z,{title:content,placement:"topLeft",mouseEnterDelay:1,children:children})},ChatUserMessage=param=>{let{message,highlightString,showModeratorMenu,sentBySelf,sameUserAsLast,isAuthorModerator,isAuthorAuthenticated}=param,{id:messageId,body,user,timestamp}=message,{id:userId,displayName,displayColor}=user,accessToken=(0,es.sJ)(ClientConfigStore.FI),color="var(--theme-color-users-".concat(displayColor,")"),formattedTimestamp="Sent ".concat(formatTimestamp(timestamp)),[formattedMessage,setFormattedMessage]=(0,react.useState)(body),badgeNodes=[];return isAuthorModerator&&badgeNodes.push((0,jsx_runtime.jsx)(ChatUserBadge,{badge:"mod",userColor:displayColor},"mod")),isAuthorAuthenticated&&badgeNodes.push((0,jsx_runtime.jsx)(ChatUserBadge,{badge:(0,jsx_runtime.jsx)(LinkOutlined.Z,{title:"authenticated"}),userColor:displayColor},"auth")),(0,react.useEffect)(()=>{setFormattedMessage(he_default().decode(body))},[message]),(0,jsx_runtime.jsx)("div",{className:classnames_default()(ChatUserMessage_module_default().messagePadding,sameUserAsLast&&ChatUserMessage_module_default().messagePaddingCollapsed),children:(0,jsx_runtime.jsxs)("div",{className:classnames_default()(ChatUserMessage_module_default().root,{[ChatUserMessage_module_default().ownMessage]:sentBySelf}),style:{borderColor:color},children:[!sameUserAsLast&&(0,jsx_runtime.jsx)(UserTooltip,{user:user,children:(0,jsx_runtime.jsxs)("div",{className:ChatUserMessage_module_default().user,style:{color},children:[(0,jsx_runtime.jsx)("span",{className:ChatUserMessage_module_default().userName,children:displayName}),(0,jsx_runtime.jsx)("span",{children:badgeNodes})]})}),(0,jsx_runtime.jsx)(tooltip.Z,{title:formattedTimestamp,mouseEnterDelay:1,children:(0,jsx_runtime.jsx)(Highlight,{search:highlightString,children:(0,jsx_runtime.jsx)("div",{className:ChatUserMessage_module_default().message,dangerouslySetInnerHTML:{__html:formattedMessage}})})}),showModeratorMenu&&(0,jsx_runtime.jsx)("div",{className:ChatUserMessage_module_default().modMenuWrapper,children:(0,jsx_runtime.jsx)(ChatModerationActionMenu,{messageID:messageId,accessToken:accessToken,userID:userId,userDisplayName:displayName})}),(0,jsx_runtime.jsx)("div",{className:ChatUserMessage_module_default().background,style:{color}})]})})};var SmileOutlined=__webpack_require__(93045),SendOutlined=__webpack_require__(27496),popover=__webpack_require__(55241),index_es=__webpack_require__(77493),dist_index_es=__webpack_require__(96391),ChatTextField_module=__webpack_require__(26912),ChatTextField_module_default=__webpack_require__.n(ChatTextField_module);let EmojiPicker=dynamic_default()(()=>Promise.all([__webpack_require__.e(7741),__webpack_require__.e(1559)]).then(__webpack_require__.bind(__webpack_require__,51559)).then(mod=>mod.EmojiPicker),{loadableGenerated:{webpack:()=>[51559]}}),Image=p=>{let{attributes,element,children}=p,selected=(0,dist_index_es.vt)(),focused=(0,dist_index_es.UE)();return(0,jsx_runtime.jsxs)("span",{...attributes,contentEditable:!1,children:[(0,jsx_runtime.jsx)("img",{alt:element.alt,src:element.src,title:element.name,style:{display:"inline",maxWidth:"50px",maxHeight:"20px",boxShadow:"".concat(selected&&focused?"0 0 0 3px #B4D5FF":"none")}}),children]})},withImages=editor=>{let{isVoid}=editor;return editor.isVoid=element=>"image"===element.type||isVoid(element),editor.isInline=element=>"image"===element.type,editor},serialize=node=>{let children;if(index_es.xv.isText(node)){let string=node.text;return string}if(0===node.children.length)children=[{text:""}];else{var ref;children=null===(ref=node.children)||void 0===ref?void 0:ref.map(n=>serialize(n)).join("")}switch(node.type){case"paragraph":return"<p>".concat(children,"</p>");case"image":return'<img src="'.concat(node.src,'" alt="').concat(node.alt,'" title="').concat(node.name,'" class="emoji"/>');default:return children}},getCharacterCount=node=>{if(index_es.xv.isText(node))return node.text.length;if("image"===node.type)return 5;let count=0;return node.children.forEach(child=>{count+=getCharacterCount(child)}),count},ChatTextField=param=>{let{defaultText}=param,[showEmojis,setShowEmojis]=(0,react.useState)(!1),[characterCount,setCharacterCount]=(0,react.useState)(null==defaultText?void 0:defaultText.length),websocketService=(0,es.sJ)(ClientConfigStore.Gt),editor=(0,react.useMemo)(()=>(0,dist_index_es.BU)(withImages((0,index_es.Jh)())),[]),sendMessage=()=>{if(!websocketService){console.log("websocketService is not defined");return}let message=serialize(editor);websocketService.send({type:socket_events.C.CHAT,body:message}),index_es.YR.delete(editor,{at:{anchor:index_es.ML.start(editor,[]),focus:index_es.ML.end(editor,[])}}),setCharacterCount(0)},createImageNode=(alt,src,name)=>({type:"image",alt,src,name,children:[{text:""}]}),insertImage=(url,name)=>{if(!url)return;let{selection}=editor,image=createImageNode(name,url,name);if(index_es.YR.insertNodes(editor,image,{select:!0}),selection){var ref;let[parentNode,parentPath]=index_es.ML.parent(editor,null===(ref=selection.focus)||void 0===ref?void 0:ref.path);editor.isVoid(parentNode)||index_es.NB.string(parentNode).length?index_es.YR.insertNodes(editor,image,{at:index_es.y$.next(parentPath),select:!0}):(index_es.YR.insertNodes(editor,image,{at:parentPath,select:!0}),index_es.ML.normalize(editor,{force:!0}))}else index_es.YR.insertNodes(editor,image,{select:!0})},onEmojiSelect=emoji=>{dist_index_es.F3.focus(editor),index_es.YR.insertText(editor,emoji)},onCustomEmojiSelect=(name,emoji)=>{dist_index_es.F3.focus(editor),insertImage(emoji,name)},onKeyDown=e=>{let charCount=getCharacterCount(editor)+1;if("Enter"===e.key){e.preventDefault(),sendMessage();return}if("Backspace"===e.key){setCharacterCount(charCount-1);return}charCount+1>300&&e.preventDefault(),setCharacterCount(charCount+1)},onPaste=e=>{let text=e.clipboardData.getData("text/plain"),{length}=text;characterCount+length>300&&e.preventDefault()},renderElement=p=>"image"===p.element.type?(0,jsx_runtime.jsx)(Image,{...p}):(0,jsx_runtime.jsx)("p",{...p});return(0,jsx_runtime.jsx)("div",{className:ChatTextField_module_default().root,children:(0,jsx_runtime.jsxs)("div",{className:classnames_default()(ChatTextField_module_default().inputWrap,characterCount>=300&&ChatTextField_module_default().maxCharacters),children:[(0,jsx_runtime.jsxs)(dist_index_es.mH,{editor:editor,value:[{type:"paragraph",children:[{text:defaultText||""}]}],children:[(0,jsx_runtime.jsx)(dist_index_es.CX,{className:"chat-text-input",onKeyDown:onKeyDown,onPaste:onPaste,renderElement:renderElement,placeholder:"Send a message to chat",style:{width:"100%"},autoFocus:!0}),(0,jsx_runtime.jsx)(popover.Z,{content:(0,jsx_runtime.jsx)(EmojiPicker,{onEmojiSelect:onEmojiSelect,onCustomEmojiSelect:onCustomEmojiSelect}),trigger:"click",onOpenChange:open=>setShowEmojis(open),open:showEmojis})]}),(0,jsx_runtime.jsxs)("div",{style:{display:"flex",paddingLeft:"5px"},children:[(0,jsx_runtime.jsx)("button",{type:"button",className:ChatTextField_module_default().emojiButton,title:"Emoji picker button",onClick:()=>setShowEmojis(!showEmojis),children:(0,jsx_runtime.jsx)(SmileOutlined.Z,{})}),(0,jsx_runtime.jsx)("button",{type:"button",className:ChatTextField_module_default().sendButton,title:"Send message Button",onClick:sendMessage,children:(0,jsx_runtime.jsx)(SendOutlined.Z,{})})]})]})})};var ChatModeratorNotification_module=__webpack_require__(93107),ChatModeratorNotification_module_default=__webpack_require__.n(ChatModeratorNotification_module);function _extends(){return(_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}var moderator=function(props){return react.createElement("svg",_extends({height:500,viewBox:"0 0 132.292 132.292",width:500,xmlns:"http://www.w3.org/2000/svg"},props),_linearGradient||(_linearGradient=react.createElement("linearGradient",{id:"moderator_svg__a",gradientUnits:"userSpaceOnUse",x1:432.851,x2:464.644,y1:49.977,y2:49.977},react.createElement("stop",{offset:0,stopColor:"#2087e2"}),react.createElement("stop",{offset:1,stopColor:"#b63fff"}))),_path||(_path=react.createElement("path",{d:"M438.672 34.08h20.151a5.82 5.82 45 0 1 5.82 5.821v20.151a5.82 5.82 135 0 1-5.82 5.821h-20.15a5.82 5.82 45 0 1-5.822-5.82V39.9a5.82 5.82 135 0 1 5.821-5.82z",fill:"url(#moderator_svg__a)",transform:"matrix(4.16112 0 0 4.16112 -1801.146 -141.814)"})),_path2||(_path2=react.createElement("path",{d:"M121.11 29.551c-6.93 47.444-30.074 104.618-77.642 79.674l25.83 23.067h38.772c13.377 0 24.22-10.845 24.22-24.222V40.864z",fill:"#1d1535",fillOpacity:.335})),_path3||(_path3=react.createElement("path",{d:"M66.775 13.257s-7.129 57.999-.63 99.312c6.565 41.724-81.568-74.394-49.619-79.203 31.949-4.809 50.249-20.11 50.249-20.11z",fill:"#e2e8f0",fillOpacity:.306})),_path4||(_path4=react.createElement("path",{d:"M435.995 42.072c6.797.447 12.753-4.806 12.753-4.806s5.955 5.253 12.752 4.806c-.581 12.745-7.495 20.586-12.752 20.628-5.188.042-12.172-7.883-12.753-20.628z",fill:"none",stroke:"#fff",strokeLinejoin:"round",strokeWidth:2,transform:"matrix(4.16112 0 0 4.16112 -1801.146 -141.814)"})))};let ChatModeratorNotification=()=>(0,jsx_runtime.jsxs)("div",{className:ChatModeratorNotification_module_default().chatModerationNotification,children:[(0,jsx_runtime.jsx)(moderator,{className:ChatModeratorNotification_module_default().icon}),"You are now a moderator."]});var lib=__webpack_require__(47049),ChatSystemMessage_module=__webpack_require__(23421),ChatSystemMessage_module_default=__webpack_require__.n(ChatSystemMessage_module);let ChatSystemMessage=param=>{let{message:{body,user:{displayName}},highlightString}=param;return(0,jsx_runtime.jsxs)("div",{className:ChatSystemMessage_module_default().chatSystemMessage,children:[(0,jsx_runtime.jsx)("div",{className:ChatSystemMessage_module_default().user,children:(0,jsx_runtime.jsx)("span",{className:ChatSystemMessage_module_default().userName,children:displayName})}),(0,jsx_runtime.jsx)(lib.Highlight,{search:highlightString,children:(0,jsx_runtime.jsx)("div",{className:ChatSystemMessage_module_default().message,dangerouslySetInnerHTML:{__html:body}})})]})};var TeamOutlined=__webpack_require__(55355),ChatJoinMessage_module=__webpack_require__(91044),ChatJoinMessage_module_default=__webpack_require__.n(ChatJoinMessage_module);let ChatJoinMessage=param=>{let{isAuthorModerator,userColor,displayName}=param;return(0,jsx_runtime.jsxs)("div",{className:ChatJoinMessage_module_default().root,children:[(0,jsx_runtime.jsxs)("span",{style:{color:"var(--theme-color-users-".concat(userColor,")")},children:[(0,jsx_runtime.jsx)("span",{style:{padding:"0 10px"},children:(0,jsx_runtime.jsx)(TeamOutlined.Z,{})}),(0,jsx_runtime.jsx)("span",{style:{fontWeight:"bold"},children:displayName}),isAuthorModerator&&(0,jsx_runtime.jsx)("span",{children:(0,jsx_runtime.jsx)(ChatUserBadge,{badge:"mod",userColor:userColor})})]})," ","joined the chat."]})};var VerticalAlignBottomOutlined=__webpack_require__(66017),es_button=__webpack_require__(71577);let ScrollToBotBtn=param=>{let{chatContainerRef,messages}=param;return(0,jsx_runtime.jsx)("div",{className:ChatContainer_module_default().toBottomWrap,children:(0,jsx_runtime.jsx)(es_button.Z,{type:"default",style:{color:"currentColor"},icon:(0,jsx_runtime.jsx)(VerticalAlignBottomOutlined.Z,{}),onClick:()=>chatContainerRef.current.scrollToIndex({index:messages.length-1,behavior:"smooth"}),children:"Go to last message"})})};var ChatActionMessage_module=__webpack_require__(65302),ChatActionMessage_module_default=__webpack_require__.n(ChatActionMessage_module);let ChatActionMessage=param=>{let{body}=param;return(0,jsx_runtime.jsx)("div",{dangerouslySetInnerHTML:{__html:body},className:ChatActionMessage_module_default().chatAction})};function checkIsModerator(message){let{user:{scopes}}=message;return!!scopes&&0!==scopes.length&&scopes.includes("MODERATOR")}let ChatContainer=param=>{let{messages,usernameToHighlight,chatUserId,isModerator,showInput,height}=param,[atBottom,setAtBottom]=(0,react.useState)(!1),chatContainerRef=(0,react.useRef)(null),getNameChangeViewForMessage=message=>{let{oldName,user}=message,{displayName,displayColor}=user,color="var(--theme-color-users-".concat(displayColor,")");return(0,jsx_runtime.jsxs)("div",{className:ChatContainer_module_default().nameChangeView,children:[(0,jsx_runtime.jsx)("div",{style:{marginRight:5,height:"max-content",margin:"auto 5px auto 0"},children:(0,jsx_runtime.jsx)(EditFilled.Z,{})}),(0,jsx_runtime.jsxs)("div",{className:ChatContainer_module_default().nameChangeText,children:[(0,jsx_runtime.jsx)("span",{style:{color},children:oldName}),(0,jsx_runtime.jsx)("span",{className:ChatContainer_module_default().plain,children:" is now known as "}),(0,jsx_runtime.jsx)("span",{style:{color},children:displayName})]})]})},getUserJoinedMessage=message=>{let{user:{displayName,displayColor}}=message,isAuthorModerator=checkIsModerator(message);return(0,jsx_runtime.jsx)(ChatJoinMessage,{displayName:displayName,userColor:displayColor,isAuthorModerator:isAuthorModerator})},getActionMessage=message=>{let{body}=message;return(0,jsx_runtime.jsx)(ChatActionMessage,{body:body})},getConnectedInfoMessage=message=>{let modStatusUpdate=checkIsModerator(message);return modStatusUpdate?(0,jsx_runtime.jsx)(ChatModeratorNotification,{}):(0,jsx_runtime.jsx)("div",{style:{width:"1px",height:"1px"}})},getViewForMessage=(index,message)=>{switch(message.type){case socket_events.C.CHAT:var ref,ref1,ref2;return(0,jsx_runtime.jsx)(ChatUserMessage,{message:message,showModeratorMenu:isModerator,highlightString:usernameToHighlight,sentBySelf:(null===(ref=message.user)||void 0===ref?void 0:ref.id)===chatUserId,sameUserAsLast:function(messages,index){if(messages.length<2)return!1;let message=messages[index];if(!message||!message.user)return!1;let{user:{id}}=message,lastMessage=messages[index-1];if((null==lastMessage?void 0:lastMessage.type)!==socket_events.C.CHAT||!lastMessage.timestamp||!message.timestamp)return!1;let lastTimestamp=new Date(lastMessage.timestamp).getTime(),thisTimestamp=new Date(message.timestamp).getTime();return!(thisTimestamp-lastTimestamp>12e4)&&id===(null==lastMessage?void 0:lastMessage.user.id)}(messages,index),isAuthorModerator:null===(ref1=message.user.scopes)||void 0===ref1?void 0:ref1.includes("MODERATOR"),isAuthorAuthenticated:null===(ref2=message.user)||void 0===ref2?void 0:ref2.authenticated},message.id);case socket_events.C.NAME_CHANGE:return getNameChangeViewForMessage(message);case socket_events.C.CONNECTED_USER_INFO:return getConnectedInfoMessage(message);case socket_events.C.USER_JOINED:return getUserJoinedMessage(message);case socket_events.C.CHAT_ACTION:return getActionMessage(message);case socket_events.C.SYSTEM:return(0,jsx_runtime.jsx)(ChatSystemMessage,{message:message,highlightString:usernameToHighlight},message.id);default:return null}},MessagesTable=(0,react.useMemo)(()=>(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(index_m.OO,{style:{height},className:ChatContainer_module_default().virtuoso,ref:chatContainerRef,initialTopMostItemIndex:messages.length-1,data:messages,itemContent:(index,message)=>getViewForMessage(index,message),followOutput:"auto",alignToBottom:!0,atBottomStateChange:bottom=>setAtBottom(bottom)}),!atBottom&&(0,jsx_runtime.jsx)(ScrollToBotBtn,{chatContainerRef:chatContainerRef,messages:messages})]}),[messages,usernameToHighlight,chatUserId,isModerator,atBottom]);return(0,jsx_runtime.jsxs)("div",{id:"chat-container",className:ChatContainer_module_default().chatContainer,children:[MessagesTable,showInput&&(0,jsx_runtime.jsx)("div",{className:ChatContainer_module_default().chatTextField,children:(0,jsx_runtime.jsx)(ChatTextField,{})})]})};ChatContainer.defaultProps={showInput:!0,height:"auto"}},65302:function(module){module.exports={chatAction:"ChatActionMessage_chatAction__x9Xsg"}},59760:function(module){module.exports={chatHeader:"ChatContainer_chatHeader__EJsYI",toBottomWrap:"ChatContainer_toBottomWrap__3V5wa",toBottomBtn:"ChatContainer_toBottomBtn__453AG",nameChangeView:"ChatContainer_nameChangeView__ziyXN",nameChangeText:"ChatContainer_nameChangeText__yXG__",plain:"ChatContainer_plain__IPS19",chatContainer:"ChatContainer_chatContainer__O2lYN",virtuoso:"ChatContainer_virtuoso__OS9Kz",chatTextField:"ChatContainer_chatTextField__OqCGL"}},91044:function(module){module.exports={root:"ChatJoinMessage_root__vuVXa"}},93107:function(module){module.exports={chatModerationNotification:"ChatModeratorNotification_chatModerationNotification__kgFWe",icon:"ChatModeratorNotification_icon__7FdGg"}},23421:function(module){module.exports={chatSystemMessage:"ChatSystemMessage_chatSystemMessage__c6XEN",user:"ChatSystemMessage_user__6yHSJ",message:"ChatSystemMessage_message__ySq5g"}},26912:function(module){module.exports={root:"ChatTextField_root__4oUkJ",inputWrap:"ChatTextField_inputWrap__1mAjD",maxCharacters:"ChatTextField_maxCharacters__yGT4s",emojiButton:"ChatTextField_emojiButton__ON_Cu",sendButton:"ChatTextField_sendButton__MOmD4"}},48976:function(module){module.exports={badge:"ChatUserBadge_badge__1EdUp"}},50085:function(module){module.exports={root:"ChatUserMessage_root__79heB",user:"ChatUserMessage_user__xUEp9",message:"ChatUserMessage_message__MJ9LD",ownMessage:"ChatUserMessage_ownMessage__d28A3",background:"ChatUserMessage_background__Tfghp",modMenuWrapper:"ChatUserMessage_modMenuWrapper__7fblv",messagePadding:"ChatUserMessage_messagePadding__Xp1F6",messagePaddingCollapsed:"ChatUserMessage_messagePaddingCollapsed__qxN0E"}}}]);