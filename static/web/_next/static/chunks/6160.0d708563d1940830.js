(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6160],{66160:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{BrowserNotifyModal:function(){return BrowserNotifyModal}});var jsx_runtime=__webpack_require__(85893),typography=__webpack_require__(84485),es_button=__webpack_require__(71577),spin=__webpack_require__(11382),row=__webpack_require__(25968),col=__webpack_require__(6226),react=__webpack_require__(67294),es=__webpack_require__(4480),ClientConfigStore=__webpack_require__(77466);async function saveNotificationRegistration(channel,destination,accessToken){let options={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({channel,destination})};try{await fetch("".concat("/api/notifications/register","?accessToken=").concat(accessToken),options)}catch(e){console.error(e)}}async function registerWebPushNotifications(vapidPublicKey){let registration=await navigator.serviceWorker.ready,subscription=await registration.pushManager.getSubscription();return subscription||(subscription=await registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(base64String){let padding="=".repeat((4-base64String.length%4)%4),base64=(base64String+padding).replace(/-/g,"+").replace(/_/g,"/"),rawData=window.atob(base64),outputArray=new Uint8Array(rawData.length);for(let i=0;i<rawData.length;++i)outputArray[i]=rawData.charCodeAt(i);return outputArray}(vapidPublicKey)})),JSON.stringify(subscription)}var BrowserNotifyModal_module=__webpack_require__(38851),BrowserNotifyModal_module_default=__webpack_require__.n(BrowserNotifyModal_module);function browserPushNotifications_isPushNotificationSupported(){return"serviceWorker"in navigator&&"PushManager"in window}let{Title}=typography.Z,NotificationsNotSupported=()=>(0,jsx_runtime.jsx)("div",{children:"Browser notifications are not supported in your browser."}),PermissionPopupPreview=param=>{let{start}=param;return(0,jsx_runtime.jsx)("div",{id:"browser-push-preview-box",className:BrowserNotifyModal_module_default().pushPreview,children:(0,jsx_runtime.jsxs)("div",{className:BrowserNotifyModal_module_default().inner,children:[(0,jsx_runtime.jsxs)("div",{className:BrowserNotifyModal_module_default().title,children:[window.location.toString()," wants to"]}),(0,jsx_runtime.jsxs)("div",{className:BrowserNotifyModal_module_default().permissionLine,children:[(0,jsx_runtime.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,jsx_runtime.jsx)("path",{d:"M14 12.3333V13H2V12.3333L3.33333 11V7C3.33333 4.93333 4.68667 3.11333 6.66667 2.52667C6.66667 2.46 6.66667 2.4 6.66667 2.33333C6.66667 1.97971 6.80714 1.64057 7.05719 1.39052C7.30724 1.14048 7.64638 1 8 1C8.35362 1 8.69276 1.14048 8.94281 1.39052C9.19286 1.64057 9.33333 1.97971 9.33333 2.33333C9.33333 2.4 9.33333 2.46 9.33333 2.52667C11.3133 3.11333 12.6667 4.93333 12.6667 7V11L14 12.3333ZM9.33333 13.6667C9.33333 14.0203 9.19286 14.3594 8.94281 14.6095C8.69276 14.8595 8.35362 15 8 15C7.64638 15 7.30724 14.8595 7.05719 14.6095C6.80714 14.3594 6.66667 14.0203 6.66667 13.6667",fill:"#676670"})}),"Show notifications"]}),(0,jsx_runtime.jsxs)("div",{className:BrowserNotifyModal_module_default().buttonRow,children:[(0,jsx_runtime.jsx)(es_button.Z,{type:"primary",className:BrowserNotifyModal_module_default().allow,onClick(){start()},children:"Allow"}),(0,jsx_runtime.jsx)("button",{type:"button",className:BrowserNotifyModal_module_default().disabled,children:"Block"})]})]})})},NotificationsEnabled=()=>(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(Title,{children:"Notifications are enabled"}),"To disable push notifications from ",window.location.hostname.toString()," access your browser permissions for this site and turn off notifications.",(0,jsx_runtime.jsx)("a",{href:"https://owncast.online/docs/notifications",children:" Learn more."})]}),BrowserNotifyModal=()=>{let[error,setError]=(0,react.useState)(null),accessToken=(0,es.sJ)(ClientConfigStore.FI),config=(0,es.sJ)(ClientConfigStore.g1),[browserPushPermissionsPending,setBrowserPushPermissionsPending]=(0,react.useState)(!1),notificationsPermitted=browserPushNotifications_isPushNotificationSupported()&&"default"!==Notification.permission,{notifications}=config,{browser}=notifications,{publicKey}=browser,browserPushSupported=browser.enabled&&browserPushNotifications_isPushNotificationSupported();if(notificationsPermitted)return(0,jsx_runtime.jsx)(NotificationsEnabled,{});let startBrowserPushRegistration=async()=>{if(!browserPushNotifications_isPushNotificationSupported()||"default"===Notification.permission){setBrowserPushPermissionsPending(!0);try{let subscription=await registerWebPushNotifications(publicKey);saveNotificationRegistration("BROWSER_PUSH_NOTIFICATION",subscription,accessToken),setError(null)}catch(e){setError("Error registering for live notifications: ".concat(e.message,". Make sure you're not inside a private browser environment or have previously disabled notifications for this stream."))}setBrowserPushPermissionsPending(!1)}};return browserPushSupported?(0,jsx_runtime.jsxs)(spin.Z,{spinning:browserPushPermissionsPending,children:[(0,jsx_runtime.jsxs)(row.Z,{align:"top",children:[(0,jsx_runtime.jsx)(Title,{children:"Browser Notifications"}),"Get notified right in the browser each time this stream goes live. Blah blah blah more description text goes here."]}),(0,jsx_runtime.jsx)(row.Z,{children:error}),(0,jsx_runtime.jsx)(row.Z,{align:"top",children:(0,jsx_runtime.jsx)(col.Z,{span:12,children:(0,jsx_runtime.jsx)(PermissionPopupPreview,{start:()=>startBrowserPushRegistration()})})})]}):(0,jsx_runtime.jsx)(NotificationsNotSupported,{})}},38851:function(module){module.exports={pushPreview:"BrowserNotifyModal_pushPreview__4Og4q",inner:"BrowserNotifyModal_inner__uhFDw",title:"BrowserNotifyModal_title__dd_Lh",permissionLine:"BrowserNotifyModal_permissionLine__K8nyJ",buttonRow:"BrowserNotifyModal_buttonRow__oxJUg",disabled:"BrowserNotifyModal_disabled__v88lb",allow:"BrowserNotifyModal_allow__M9AWC"}}}]);