(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2885],{16791:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/stream-health",function(){return a(17253)}])},94185:function(e,t,a){"use strict";a.d(t,{k:function(){return c}});var i=a(85893),r=a(9085),n=a(92616),s=a.n(n),o=a(58091),l=a(60727);function d(e){let t={};return e.forEach(e=>{let a=new Date(e.time),i=(0,o.Z)(a,"H:mma");t[i]=e.value}),t}s().use(r.ZP);let c=e=>{let{data:t,title:a,color:r,unit:n,dataCollections:s,yFlipped:o,yLogarithmic:c}=e,u=[];t&&t.length>0&&u.push({name:a,color:r,data:d(t)}),s.forEach(e=>{u.push({name:e.name,data:d(e.data),color:e.color,dataset:e.options})});let h={scales:{y:{reverse:!1,type:"linear"},x:{type:"time"}}};return h.scales.y.reverse=o,h.scales.y.type=c?"logarithmic":"linear",(0,i.jsx)("div",{className:"line-chart-container",children:(0,i.jsx)(l.wW,{xtitle:"Time",ytitle:a,suffix:n,legend:"bottom",color:r,data:u,download:a,library:h})})};c.defaultProps={dataCollections:[],data:[],title:"",yFlipped:!1,yLogarithmic:!1}},28073:function(e,t,a){"use strict";a.d(t,{j:function(){return x}});var i=a(85893),r=a(8751),n=a(11475),s=a(71230),o=a(15746),l=a(74763),d=a(84485),c=a(14670),u=a(71577),h=a(41664),y=a.n(h),p=a(67294),m=a(99519);let x=e=>{let{showTroubleshootButton:t}=e,a=(0,p.useContext)(m.aC),{health:h}=a;if(!h)return null;let{healthy:x,healthPercentage:g,message:f,representation:w}=h,v="#3f8600",j="info";return g<80?(v="#cf000f",j="error"):g<30&&(v="#f0ad4e",j="error"),(0,i.jsxs)("div",{children:[(0,i.jsxs)(s.Z,{gutter:8,children:[(0,i.jsx)(o.Z,{span:12,children:(0,i.jsx)(l.Z,{title:"Healthy Stream",value:x?"Yes":"No",valueStyle:{color:v},prefix:x?(0,i.jsx)(r.Z,{}):(0,i.jsx)(n.Z,{})})}),(0,i.jsx)(o.Z,{span:12,children:(0,i.jsx)(l.Z,{title:"Playback Health",value:g,valueStyle:{color:v},suffix:"%"})})]}),(0,i.jsx)(s.Z,{style:{display:w<100&&0!==w?"grid":"none"},children:(0,i.jsxs)(d.Z.Text,{type:"secondary",style:{textAlign:"center",fontSize:"0.7em",opacity:"0.3"},children:["Stream health represents ",w,"% of all known players. Other player status is unknown."]})}),(0,i.jsx)(s.Z,{gutter:16,style:{width:"100%",display:f?"grid":"none",marginTop:"10px"},children:(0,i.jsx)(o.Z,{span:24,children:(0,i.jsx)(c.Z,{message:f,type:j,showIcon:!0,action:t&&(0,i.jsx)(y(),{passHref:!0,href:"/stream-health",children:(0,i.jsx)(u.Z,{size:"small",type:"text",style:{color:"black"},children:"TROUBLESHOOT"})})})})})]})};x.defaultProps={showTroubleshootButton:!0}},17253:function(e,t,a){"use strict";a.r(t);var i=a(85893),r=a(84485),n=a(14670),s=a(11382),o=a(26713),l=a(71230),d=a(15746),c=a(59652),u=a(74763),h=a(67294),y=a(93069),p=a(24019),m=a(28058),x=a(64777),g=a(94185),f=a(28073);let w=e=>{let{title:t,description:a}=e;return(0,i.jsxs)("div",{className:"description-box",children:[(0,i.jsx)(r.Z.Title,{children:t}),(0,i.jsx)(r.Z.Paragraph,{children:a})]})},v=()=>{var e,t,a,v,j,b,F;let[Z,k]=(0,h.useState)([]),[S,P]=(0,h.useState)([]),[T,N]=(0,h.useState)(),[C,D]=(0,h.useState)(),[E,L]=(0,h.useState)([]),[B,I]=(0,h.useState)([]),[_,q]=(0,h.useState)([]),[O,H]=(0,h.useState)([]),[M,V]=(0,h.useState)([]),[R,z]=(0,h.useState)([]),[A,Q]=(0,h.useState)([]),[Y,X]=(0,h.useState)([]),[U,W]=(0,h.useState)(0),$=async()=>{try{let e=await (0,x.rQ)(x.N$);k(e.errors),P(e.qualityVariantChanges),D(e.highestLatency),N(e.lowestLatency),L(e.medianLatency),I(e.medianSegmentDownloadDuration),q(e.maximumSegmentDownloadDuration),H(e.minimumSegmentDownloadDuration),V(e.minPlayerBitrate),z(e.medianPlayerBitrate),Q(e.maxPlayerBitrate),X(e.availableBitrates),W(e.segmentLength-.3)}catch(t){console.error(t)}};(0,h.useEffect)(()=>{let e=null;return $(),e=setInterval($,x.NE),()=>{clearInterval(e)}},[]);let G=(0,i.jsxs)("div",{children:[(0,i.jsx)(r.Z.Title,{children:"Stream Performance"}),(0,i.jsx)(n.Z,{type:"info",message:" Data has not yet been collected. Once a stream has begun and viewers are watching this page will be available."}),(0,i.jsx)(s.Z,{size:"large",children:(0,i.jsx)("div",{style:{marginTop:"50px",height:"100px"}})})]});if(!(null==Z?void 0:Z.length)||!(null==E?void 0:E.length)||!(null==B?void 0:B.length))return G;let J=[{name:"Errors",color:"#B63FFF",options:{radius:3},data:Z},{name:"Quality changes",color:"#2087E2",options:{radius:2},data:S}],K=[{name:"Max download duration",color:"#B63FFF",options:{radius:2},data:_},{name:"Median download duration",color:"#00FFFF",options:{radius:2},data:B},{name:"Min download duration",color:"#02FD0D",options:{radius:2},data:O},{name:"Approximate limit",color:"#003FFF",data:B.map(e=>({time:e.time,value:U})),options:{radius:0}}],ee=[{name:"Lowest player speed",color:"#B63FFF",data:M,options:{radius:2}},{name:"Median player speed",color:"#00FFFF",data:R,options:{radius:2}},{name:"Maximum player speed",color:"#02FD0D",data:A,options:{radius:2}}];Y.forEach(e=>{ee.push({name:"Available bitrate",color:"#003FFF",data:M.map(t=>({time:t.time,value:e})),options:{radius:0}})});let et=null===(e=null===(t=ee[0])||void 0===t?void 0:t.data[ee[0].data.length-1])||void 0===e?void 0:e.value,ea=null===(a=B[B.length-1])||void 0===a?void 0:a.value,ei=Y[0],er=(null===(v=E[E.length-1])||void 0===v?void 0:v.value)||0,en=(null===(j=C[C.length-1])||void 0===j?void 0:j.value)||0,es=(null===(b=T[T.length-1])||void 0===b?void 0:b.value)||0,eo=(Number(en)+Number(es)+Number(er))/3,el=0,ed=(null===(F=J[0])||void 0===F?void 0:F.data.length)||0;if(ed>5){let ec=J[0].data.slice(-5);el=ec.reduce((e,t)=>e+Number(t.value),0)}else el=J[0].data.reduce((e,t)=>e+Number(t.value),0);let eu=et>0||ea>0||el>0,eh=null,ey=null;0!==et&&et<ei&&(eh="One of your viewers is playing your stream at ".concat(et,"kbps, slower than ").concat(ei,"kbps, the lowest quality you made available. Consider adding a lower quality with a lower bitrate if the errors over time warrant this.")),ea>U&&(ey="Your viewers may be consuming your video slower than required. This may be due to slow networks or your latency configuration. You need to decrease the amount of time viewers are taking to consume your video. Consider adding a lower quality with a lower bitrate or experiment with increasing the latency buffer setting.");let ep=el>0?"#B63FFF":"#FFFFFF",em={display:"flex",alignItems:"center",justifyContent:"center",height:"80px"};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.Z.Title,{children:"Stream Performance"}),(0,i.jsx)(r.Z.Paragraph,{children:"This tool hopes to help you identify and troubleshoot problems you may be experiencing with your stream. It aims to aggregate experiences across your viewers, meaning one viewer with an exceptionally bad experience may throw off numbers for the whole, especially with a low number of viewers."}),(0,i.jsx)(r.Z.Paragraph,{children:"The data is only collected by those using the Owncast web interface and is unable to gain insight into external players people may be using such as VLC, MPV, QuickTime, etc."}),(0,i.jsxs)(o.Z,{direction:"vertical",size:"middle",children:[(0,i.jsx)(l.Z,{justify:"space-around",children:(0,i.jsx)(d.Z,{style:{width:"100%"},children:(0,i.jsx)(c.Z,{type:"inner",children:(0,i.jsx)(f.j,{showTroubleshootButton:!1})})})}),(0,i.jsxs)(l.Z,{gutter:[16,16],justify:"space-around",style:{display:eu?"flex":"none"},children:[(0,i.jsx)(d.Z,{children:(0,i.jsx)(c.Z,{type:"inner",children:(0,i.jsx)("div",{style:em,children:(0,i.jsx)(u.Z,{title:"Viewer Playback Speed",value:"".concat(et),prefix:(0,i.jsx)(y.Z,{style:{marginRight:"5px"}}),precision:0,suffix:"kbps"})})})}),(0,i.jsx)(d.Z,{children:(0,i.jsx)(c.Z,{type:"inner",children:(0,i.jsx)("div",{style:em,children:(0,i.jsx)(u.Z,{title:"Viewer Latency",value:"".concat(eo),prefix:(0,i.jsx)(p.Z,{style:{marginRight:"5px"}}),precision:0,suffix:"seconds"})})})}),(0,i.jsx)(d.Z,{children:(0,i.jsx)(c.Z,{type:"inner",children:(0,i.jsx)("div",{style:em,children:(0,i.jsx)(u.Z,{title:"Recent Playback Errors",value:"".concat(el||0),valueStyle:{color:ep},prefix:(0,i.jsx)(m.Z,{style:{marginRight:"5px"}}),suffix:""})})})})]}),(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(w,{title:"Video Segment Download",description:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.Z.Paragraph,{children:"Once a video segment takes too long to download a viewer will experience buffering. If you see slow downloads you should offer a lower quality for your viewers, or find other ways, possibly an external storage provider, a CDN or a faster network, to improve your stream quality. Increasing your latency buffer can also help for some viewers."}),(0,i.jsx)(r.Z.Paragraph,{children:"In short, once the pink line consistently gets near the blue line, your stream is likely experiencing problems for viewers."})]})}),ey&&(0,i.jsx)(n.Z,{message:"Slow downloads",description:ey,type:"error",showIcon:!0}),(0,i.jsx)(g.k,{title:"Seconds",dataCollections:K,color:"#FF7700",unit:"s",yLogarithmic:!0})]}),(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(w,{title:"Player Network Speed",description:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.Z.Paragraph,{children:"The playback bitrate of your viewers. Once somebody's bitrate drops below the lowest video variant bitrate they will experience buffering. If you see viewers with slow connections trying to play your video you should consider offering an additional, lower quality."}),(0,i.jsx)(r.Z.Paragraph,{children:"In short, once the pink line gets near the lowest blue line, your stream is likely experiencing problems for at least one of your viewers."})]})}),eh&&(0,i.jsx)(n.Z,{message:"Low bandwidth viewers",description:eh,type:"error",showIcon:!0}),(0,i.jsx)(g.k,{title:"Lowest Player Bitrate",dataCollections:ee,color:"#FF7700",unit:"kbps",yLogarithmic:!0})]}),(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(w,{title:"Errors and Quality Changes",description:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.Z.Paragraph,{children:"Recent number of errors, including buffering, and quality changes from across all your viewers. Errors can occur for many reasons, including browser issues, plugins, wifi problems, and they don't all represent fatal issues or something you have control over."}),"A quality change is not necessarily a negative thing, but if it's excessive and coinciding with errors you should consider adding another quality variant.",(0,i.jsx)(r.Z.Paragraph,{})]})}),(0,i.jsx)(g.k,{title:"#",dataCollections:J,color:"#FF7700",unit:""})]}),(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(w,{title:"Viewer Latency",description:"An approximate number of seconds that your viewers are behind your live video. The largest cause of latency spikes is buffering. High latency itself is not a problem, and optimizing for low latency can result in buffering, resulting in even higher latency."}),(0,i.jsx)(g.k,{title:"Seconds",dataCollections:[{name:"Median stream latency",color:"#00FFFF",options:{radius:2},data:E},{name:"Lowest stream latency",color:"#02FD0D",options:{radius:2},data:T},{name:"Highest stream latency",color:"#B63FFF",options:{radius:2},data:C}],color:"#FF7700",unit:"s"})]})]})]})};t.default=v}},function(e){e.O(0,[2196,8091,575,5101,4763,236,2934,9774,2888,179],function(){return e(e.s=16791)}),_N_E=e.O()}]);