(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6109],{87547:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{Z:function(){return icons_UserOutlined}});var objectSpread2=__webpack_require__(1413),react=__webpack_require__(67294),asn_UserOutlined={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M858.5 763.6a374 374 0 00-80.6-119.5 375.63 375.63 0 00-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 00-80.6 119.5A371.7 371.7 0 00136 901.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 008-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"}}]},name:"user",theme:"outlined"},AntdIcon=__webpack_require__(42135),UserOutlined_UserOutlined=function(props,ref){return react.createElement(AntdIcon.Z,(0,objectSpread2.Z)((0,objectSpread2.Z)({},props),{},{ref:ref,icon:asn_UserOutlined}))};UserOutlined_UserOutlined.displayName="UserOutlined";var icons_UserOutlined=react.forwardRef(UserOutlined_UserOutlined)},77349:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{Z:function(){return addDays}});var _lib_toInteger_index_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(83946),_toDate_index_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(19013),_lib_requiredArgs_index_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(13882);function addDays(dirtyDate,dirtyAmount){(0,_lib_requiredArgs_index_js__WEBPACK_IMPORTED_MODULE_0__.Z)(2,arguments);var date=(0,_toDate_index_js__WEBPACK_IMPORTED_MODULE_1__.Z)(dirtyDate),amount=(0,_lib_toInteger_index_js__WEBPACK_IMPORTED_MODULE_2__.Z)(dirtyAmount);return isNaN(amount)?new Date(NaN):(amount&&date.setDate(date.getDate()+amount),date)}},11640:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{Z:function(){return addMonths}});var _lib_toInteger_index_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(83946),_toDate_index_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(19013),_lib_requiredArgs_index_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(13882);function addMonths(dirtyDate,dirtyAmount){(0,_lib_requiredArgs_index_js__WEBPACK_IMPORTED_MODULE_0__.Z)(2,arguments);var date=(0,_toDate_index_js__WEBPACK_IMPORTED_MODULE_1__.Z)(dirtyDate),amount=(0,_lib_toInteger_index_js__WEBPACK_IMPORTED_MODULE_2__.Z)(dirtyAmount);if(isNaN(amount))return new Date(NaN);if(!amount)return date;var dayOfMonth=date.getDate(),endOfDesiredMonth=new Date(date.getTime());return(endOfDesiredMonth.setMonth(date.getMonth()+amount+1,0),dayOfMonth>=endOfDesiredMonth.getDate())?endOfDesiredMonth:(date.setFullYear(endOfDesiredMonth.getFullYear(),endOfDesiredMonth.getMonth(),dayOfMonth),date)}},23279:function(module,__unused_webpack_exports,__webpack_require__){var isObject=__webpack_require__(13218),now=__webpack_require__(7771),toNumber=__webpack_require__(14841),nativeMax=Math.max,nativeMin=Math.min;module.exports=function(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=!1,maxing=!1,trailing=!0;if("function"!=typeof func)throw TypeError("Expected a function");function invokeFunc(time){var args=lastArgs,thisArg=lastThis;return lastArgs=lastThis=void 0,lastInvokeTime=time,result=func.apply(thisArg,args)}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;return void 0===lastCallTime||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait}function timerExpired(){var timeSinceLastCall,timeSinceLastInvoke,timeWaiting,time=now();if(shouldInvoke(time))return trailingEdge(time);timerId=setTimeout(timerExpired,(timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,timeWaiting=wait-timeSinceLastCall,maxing?nativeMin(timeWaiting,maxWait-timeSinceLastInvoke):timeWaiting))}function trailingEdge(time){return(timerId=void 0,trailing&&lastArgs)?invokeFunc(time):(lastArgs=lastThis=void 0,result)}function debounced(){var time,time1=now(),isInvoking=shouldInvoke(time1);if(lastArgs=arguments,lastThis=this,lastCallTime=time1,isInvoking){if(void 0===timerId)return lastInvokeTime=time=lastCallTime,timerId=setTimeout(timerExpired,wait),leading?invokeFunc(time):result;if(maxing)return clearTimeout(timerId),timerId=setTimeout(timerExpired,wait),invokeFunc(lastCallTime)}return void 0===timerId&&(timerId=setTimeout(timerExpired,wait)),result}return wait=toNumber(wait)||0,isObject(options)&&(leading=!!options.leading,maxWait=(maxing="maxWait"in options)?nativeMax(toNumber(options.maxWait)||0,wait):maxWait,trailing="trailing"in options?!!options.trailing:trailing),debounced.cancel=function(){void 0!==timerId&&clearTimeout(timerId),lastInvokeTime=0,lastArgs=lastCallTime=lastThis=timerId=void 0},debounced.flush=function(){return void 0===timerId?result:trailingEdge(now())},debounced}},7771:function(module,__unused_webpack_exports,__webpack_require__){var root=__webpack_require__(55639);module.exports=function(){return root.Date.now()}},92794:function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/viewer-info",function(){return __webpack_require__(1555)}])},94185:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{k:function(){return Chart}});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(85893),chart_js_auto__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(29217),chartkick__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(92616),chartkick__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(chartkick__WEBPACK_IMPORTED_MODULE_2__),date_fns_format__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(58091),react_chartkick__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(60727);function createGraphDataset(dataArray){let dataValues={};return dataArray.forEach(item=>{let dateObject=new Date(item.time),dateString=(0,date_fns_format__WEBPACK_IMPORTED_MODULE_4__.Z)(dateObject,"H:mma");dataValues[dateString]=item.value}),dataValues}chartkick__WEBPACK_IMPORTED_MODULE_2___default().use(chart_js_auto__WEBPACK_IMPORTED_MODULE_1__.Z);let Chart=param=>{let{data,title,color,unit,dataCollections,yFlipped,yLogarithmic}=param,renderData=[];data&&data.length>0&&renderData.push({name:title,color,data:createGraphDataset(data)}),dataCollections.forEach(collection=>{renderData.push({name:collection.name,data:createGraphDataset(collection.data),color:collection.color,dataset:collection.options})});let options={scales:{y:{reverse:!1,type:"linear"},x:{type:"time"}}};return options.scales.y.reverse=yFlipped,options.scales.y.type=yLogarithmic?"logarithmic":"linear",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"line-chart-container",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(react_chartkick__WEBPACK_IMPORTED_MODULE_3__.wW,{xtitle:"Time",ytitle:title,suffix:unit,legend:"bottom",color:color,data:renderData,download:title,library:options})})};Chart.defaultProps={dataCollections:[],data:[],title:"",yFlipped:!1,yLogarithmic:!1}},57390:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{m:function(){return StatisticItem}});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(85893),antd__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(84485),antd__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(97910),antd__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(74763),antd__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(59652);let{Text}=antd__WEBPACK_IMPORTED_MODULE_1__.Z,defaultProps={title:"",value:0,prefix:null,suffix:null,color:"",progress:!1,centered:!1,formatter:null},Content=param=>{let{prefix,value,suffix,title}=param;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{children:[prefix,(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(Text,{type:"secondary",children:title})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(Text,{type:"secondary",children:[value,suffix||"%"]})})]})},ProgressView=param=>{let{title,value,prefix,suffix,color}=param,content=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(Content,{prefix:prefix,value:value,suffix:suffix,title:title});return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_2__.Z,{type:"dashboard",percent:value,width:120,strokeColor:{"0%":color,"90%":value>90?"red":color},format:()=>content})};ProgressView.defaultProps=defaultProps;let StatisticView=param=>{let{title,value,prefix,formatter}=param;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_3__.Z,{title:title,value:value,prefix:prefix,formatter:formatter})};StatisticView.defaultProps=defaultProps;let StatisticItem=props=>{let{progress,centered}=props,View=progress?ProgressView:StatisticView;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_4__.Z,{type:"inner",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{style:centered?{display:"flex",alignItems:"center",justifyContent:"center"}:{},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(View,{...props})})})};StatisticItem.defaultProps=defaultProps},1555:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return ViewersOverTime}});var jsx_runtime=__webpack_require__(85893),react=__webpack_require__(67294),es_menu=__webpack_require__(66516),typography=__webpack_require__(84485),row=__webpack_require__(25968),col=__webpack_require__(6226),es_alert=__webpack_require__(14670),spin=__webpack_require__(11382),dropdown=__webpack_require__(38504),UserOutlined=__webpack_require__(87547),DownOutlined=__webpack_require__(80882),addDays=__webpack_require__(77349),requiredArgs=__webpack_require__(13882),toInteger=__webpack_require__(83946),addMonths=__webpack_require__(11640);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function sub(date,duration){if((0,requiredArgs.Z)(2,arguments),!duration||"object"!==_typeof(duration))return new Date(NaN);var years=duration.years?(0,toInteger.Z)(duration.years):0,months=duration.months?(0,toInteger.Z)(duration.months):0,weeks=duration.weeks?(0,toInteger.Z)(duration.weeks):0,days=duration.days?(0,toInteger.Z)(duration.days):0,hours=duration.hours?(0,toInteger.Z)(duration.hours):0,minutes=duration.minutes?(0,toInteger.Z)(duration.minutes):0,seconds=duration.seconds?(0,toInteger.Z)(duration.seconds):0,dateWithoutDays=function(dirtyDate,dirtyAmount){(0,requiredArgs.Z)(2,arguments);var amount=(0,toInteger.Z)(dirtyAmount);return(0,addDays.Z)(dirtyDate,-amount)}(function(dirtyDate,dirtyAmount){(0,requiredArgs.Z)(2,arguments);var amount=(0,toInteger.Z)(dirtyAmount);return(0,addMonths.Z)(dirtyDate,-amount)}(date,months+12*years),days+7*weeks);return new Date(dateWithoutDays.getTime()-1e3*(seconds+60*(minutes+60*hours)))}var toDate=__webpack_require__(19013),Chart=__webpack_require__(94185),StatisticItem=__webpack_require__(57390),table=__webpack_require__(93626),formatDistanceToNow=__webpack_require__(45938),utils_format=__webpack_require__(70241);let ViewerTable=param=>{let{data}=param;return(0,jsx_runtime.jsx)(table.Z,{pagination:{hideOnSinglePage:!0},className:"table-container",columns:[{title:"User Agent",dataIndex:"userAgent",key:"userAgent",render:ua=>(0,utils_format.AB)(ua)},{title:"Location",dataIndex:"geo",key:"geo",render:geo=>geo?"".concat(geo.regionName,", ").concat(geo.countryCode):"-"},{title:"Watch Time",dataIndex:"firstSeen",key:"firstSeen",defaultSortOrder:"ascend",render:time=>(0,formatDistanceToNow.Z)(new Date(time)),sorter:(a,b)=>new Date(a.firstSeen).getTime()-new Date(b.firstSeen).getTime(),sortDirections:["descend","ascend"]}],dataSource:data,size:"small",rowKey:"id"})};var server_status_context=__webpack_require__(99519),apis=__webpack_require__(64777);function ViewersOverTime(){let streamStart;let context=(0,react.useContext)(server_status_context.aC),{online,broadcaster,viewerCount,overallPeakViewerCount,sessionPeakViewerCount}=context||{};broadcaster&&broadcaster.time&&(streamStart=new Date(broadcaster.time));let times=[{title:"Current stream",start:streamStart},{title:"Last 12 hours",start:sub(new Date,{hours:12})},{title:"Last 24 hours",start:sub(new Date,{hours:24})},{title:"Last 7 days",start:sub(new Date,{days:7})},{title:"Last 30 days",start:sub(new Date,{days:30})},{title:"Last 3 months",start:sub(new Date,{months:3})},{title:"Last 6 months",start:sub(new Date,{months:6})}],[loadingChart,setLoadingChart]=(0,react.useState)(!0),[viewerInfo,setViewerInfo]=(0,react.useState)([]),[viewerDetails,setViewerDetails]=(0,react.useState)([]),[timeWindowStart,setTimeWindowStart]=(0,react.useState)(times[1]),getInfo=async()=>{try{let url="".concat(apis.iV,"?windowStart=").concat(function(dirtyDate){return(0,requiredArgs.Z)(1,arguments),Math.floor(function(dirtyDate){return(0,requiredArgs.Z)(1,arguments),(0,toDate.Z)(dirtyDate).getTime()}(dirtyDate)/1e3)}(timeWindowStart.start)),result=await (0,apis.rQ)(url);setViewerInfo(result),setLoadingChart(!1)}catch(error){console.log("==== error",error)}try{let result1=await (0,apis.rQ)(apis.a_);setViewerDetails(result1)}catch(error1){console.log("==== error",error1)}};(0,react.useEffect)(()=>{let getStatusIntervalId=null;return(getInfo(),online)?(getStatusIntervalId=setInterval(getInfo,6e4),()=>{clearInterval(getStatusIntervalId)}):()=>[]},[online,timeWindowStart]);let onTimeWindowSelect=param=>{let{key}=param;setTimeWindowStart(times[key])},menu=(0,jsx_runtime.jsxs)(es_menu.Z,{children:[online&&streamStart&&(0,jsx_runtime.jsx)(es_menu.Z.Item,{onClick:onTimeWindowSelect,children:times[0].title},"0"),times.slice(1).map((time,index)=>(0,jsx_runtime.jsx)(es_menu.Z.Item,{onClick:onTimeWindowSelect,children:time.title},index+1))]});return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(typography.Z.Title,{children:"Viewer Info"}),(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsxs)(row.Z,{gutter:[16,16],justify:"space-around",children:[online&&(0,jsx_runtime.jsx)(col.Z,{span:8,md:8,children:(0,jsx_runtime.jsx)(StatisticItem.m,{title:"Current viewers",value:viewerCount.toString(),prefix:(0,jsx_runtime.jsx)(UserOutlined.Z,{})})}),(0,jsx_runtime.jsx)(col.Z,{md:online?8:12,children:(0,jsx_runtime.jsx)(StatisticItem.m,{title:online?"Max viewers this stream":"Max viewers last stream",value:sessionPeakViewerCount.toString(),prefix:(0,jsx_runtime.jsx)(UserOutlined.Z,{})})}),(0,jsx_runtime.jsx)(col.Z,{md:online?8:12,children:(0,jsx_runtime.jsx)(StatisticItem.m,{title:"All-time max viewers",value:overallPeakViewerCount.toString(),prefix:(0,jsx_runtime.jsx)(UserOutlined.Z,{})})})]}),!viewerInfo.length&&(0,jsx_runtime.jsx)(es_alert.Z,{style:{marginTop:"10px"},banner:!0,message:"Please wait",description:"No viewer data has been collected yet.",type:"info"}),(0,jsx_runtime.jsxs)(spin.Z,{spinning:!viewerInfo.length||loadingChart,children:[(0,jsx_runtime.jsx)(dropdown.Z,{overlay:menu,trigger:["click"],children:(0,jsx_runtime.jsxs)("button",{type:"button",style:{float:"right",background:"transparent",border:"unset"},children:[timeWindowStart.title," ",(0,jsx_runtime.jsx)(DownOutlined.Z,{})]})}),viewerInfo.length>0&&(0,jsx_runtime.jsx)(Chart.k,{title:"Viewers",data:viewerInfo,color:"#2087E2",unit:""}),(0,jsx_runtime.jsx)(ViewerTable,{data:viewerDetails})]})]})}}},function(__webpack_require__){__webpack_require__.O(0,[2757,8939,3903,4267,3626,8091,4381,5938,5315,4763,2139,7910,9774,2888,179],function(){return __webpack_require__(__webpack_require__.s=92794)}),_N_E=__webpack_require__.O()}]);